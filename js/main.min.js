const AUTHOR_NAME="Korosium";const AVAILABLE_VERSION=["ADFGX","ADFGVX","ADFGVX with Base32"];const PLAINTEXT_EMPTY_ERR_MSG="The plaintext is empty.";const CIPHERTEXT_EMPTY_ERR_MSG="The ciphertext is empty.";const KEY_EMPTY_ERR_MSG="The key is empty.";const plaintext_textarea=document.getElementById("plaintext-textarea");const plaintext_encrypt_btn=document.getElementById("plaintext-encrypt-btn");const plaintext_copy_btn=document.getElementById("plaintext-copy-btn");const plaintext_delete_btn=document.getElementById("plaintext-delete-btn");const ciphertext_textarea=document.getElementById("ciphertext-textarea");const ciphertext_decrypt_btn=document.getElementById("ciphertext-decrypt-btn");const ciphertext_copy_btn=document.getElementById("ciphertext-copy-btn");const ciphertext_delete_btn=document.getElementById("ciphertext-delete-btn");const key_input=document.getElementById("key-input");const key_show_btn=document.getElementById("key-show-btn");const key_copy_btn=document.getElementById("key-copy-btn");const key_delete_btn=document.getElementById("key-delete-btn");const alphabet_table=document.getElementById("alphabet-table");const version_select=document.getElementById("version-select");const alphabet_input=document.getElementById("alphabet-input");const alphabet_new_btn=document.getElementById("alphabet-new-btn");const alphabet_copy_btn=document.getElementById("alphabet-copy-btn");const alphabet_delete_btn=document.getElementById("alphabet-delete-btn");plaintext_encrypt_btn.onclick=()=>encrypt_plaintext();plaintext_copy_btn.onclick=()=>copy_text_to_clipboard(plaintext_textarea.value);plaintext_delete_btn.onclick=()=>plaintext_textarea.value="";ciphertext_decrypt_btn.onclick=()=>decrypt_ciphertext();ciphertext_copy_btn.onclick=()=>copy_text_to_clipboard(ciphertext_textarea.value);ciphertext_delete_btn.onclick=()=>ciphertext_textarea.value="";key_show_btn.onclick=()=>show_hide_key();key_copy_btn.onclick=()=>copy_text_to_clipboard(key_input.value);key_delete_btn.onclick=()=>key_input.value="";version_select.onchange=()=>change_polybius_square_based_on_alphabet();alphabet_input.oninput=()=>change_polybius_square_based_on_alphabet(alphabet_input.value);alphabet_new_btn.onclick=()=>generate_new_alphabet();alphabet_copy_btn.onclick=()=>copy_text_to_clipboard(alphabet_input.value);alphabet_delete_btn.onclick=()=>delete_alphabet();const encrypt_plaintext=()=>{try{if(plaintext_textarea.value==="")throw new Error(PLAINTEXT_EMPTY_ERR_MSG);if(key_input.value==="")throw new Error(KEY_EMPTY_ERR_MSG);const answer=encrypt_with_right_algo(key_input.value,plaintext_textarea.value,alphabet_input.value,version_select.value);ciphertext_textarea.value=answer.ciphertext;alphabet_input.value=answer.alphabet;change_polybius_square_based_on_alphabet(alphabet_input.value);}catch(error){window.alert(error.message);}};const encrypt_with_right_algo=(key,plaintext,alphabet,version)=>{switch(version){case AVAILABLE_VERSION[0]:return adfgx.encrypt(key,plaintext,alphabet);case AVAILABLE_VERSION[1]:return adfgx.encrypt(key,plaintext,alphabet);case AVAILABLE_VERSION[2]:return adfgx.encrypt(key,base32.CROCKFORD_BASE_32.encode(plaintext),alphabet);}};const decrypt_ciphertext=()=>{try{if(ciphertext_textarea.value==="")throw new Error(CIPHERTEXT_EMPTY_ERR_MSG);if(key_input.value==="")throw new Error(KEY_EMPTY_ERR_MSG);plaintext_textarea.value=decrypt_with_right_algo(key_input.value,ciphertext_textarea.value,alphabet_input.value,version_select.value);}catch(error){window.alert(error.message);}};const decrypt_with_right_algo=(key,ciphertext,alphabet,version)=>{switch(version){case AVAILABLE_VERSION[0]:return adfgx.decrypt(key,ciphertext,alphabet);case AVAILABLE_VERSION[1]:return adfgx.decrypt(key,ciphertext,alphabet);case AVAILABLE_VERSION[2]:return base32.CROCKFORD_BASE_32.decode.to_utf8(adfgx.decrypt(key,ciphertext,alphabet));}};const show_hide_key=()=>{if(key_input.type==="password"){key_input.type="text";key_show_btn.innerHTML="Hide";}else{key_input.type="password";key_show_btn.innerHTML="Show";}};const copy_text_to_clipboard=s=>navigator.clipboard.writeText(s);const generate_new_alphabet=()=>{alphabet_input.value=adfgx.generate_alphabet(version_select.value.length>5);change_polybius_square_based_on_alphabet(alphabet_input.value);};const delete_alphabet=()=>{alphabet_input.value="";change_polybius_square_based_on_alphabet(alphabet_input.value);};const fill_select=(select,array)=>{for(let i=0;i<array.length;i++){const option=document.createElement("option");option.value=array[i];option.innerHTML=array[i];select.append(option);}};const change_polybius_square_based_on_alphabet=(alphabet=undefined)=>{if(version_select.selectedIndex===0){create_table(AVAILABLE_VERSION[0],alphabet);}else{create_table(AVAILABLE_VERSION[1],alphabet);}};const change_alphabet_based_on_polybius_square=()=>{const polybius_square=get_right_polybius_square();let new_alphabet="";for(let y=0;y<polybius_square.length;y++){for(let x=0;x<polybius_square.length;x++){const input=document.getElementById(`${polybius_square[y]}${polybius_square[x]}`);new_alphabet+=input.value;}}alphabet_input.value=new_alphabet;};const get_right_polybius_square=()=>{if(version_select.selectedIndex===0){return AVAILABLE_VERSION[0];}else{return AVAILABLE_VERSION[1];}};const create_table=(polybius_square,alphabet=adfgx.generate_alphabet(polybius_square.length===6))=>{const original_length=alphabet.length;if(polybius_square.length===6)alphabet+="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";alphabet=adfgx.encrypt("","",alphabet).alphabet;alphabet=alphabet.slice(0,original_length);const table=create_initial_table();table.append(create_table_head(polybius_square));table.append(create_table_body(polybius_square,alphabet));alphabet_table.innerHTML="";alphabet_table.append(table);change_alphabet_based_on_polybius_square();};const create_initial_table=()=>{const table=document.createElement("table");table.className="table table-dark table-bordered";table.style.width="270px";return table;};const create_table_head=(polybius_square)=>{const thead=document.createElement("thead");const tr=document.createElement("tr");for(let i=0;i<polybius_square.length+1;i++){const th=document.createElement("th");th.scope="col";th.style.width="30px";tr.append(th);if(i===0){th.innerHTML="";}else{th.innerHTML=polybius_square[i-1];}}thead.append(tr);return thead;};const create_table_body=(polybius_square,alphabet)=>{const tbody=document.createElement("tbody");for(let y=0;y<polybius_square.length;y++){const tr=document.createElement("tr");for(let x=0;x<polybius_square.length+1;x++){if(x===0){const th=document.createElement("th");th.style.verticalAlign="middle";th.innerHTML=polybius_square[y];th.scope="row";tr.append(th);}else{tr.append(create_table_cell(polybius_square,alphabet,x,y));}}tbody.append(tr);}return tbody;};const create_table_cell=(polybius_square,alphabet,x,y)=>{const td=document.createElement("td");td.style.padding="0";const inp=document.createElement("input");inp.type="text";inp.className="form-control text-center";inp.id=`${polybius_square[y]}${polybius_square[x - 1]}`;inp.maxLength=1;inp.oninput=()=>{inp.value=inp.value.toUpperCase();change_alphabet_based_on_polybius_square();};const retrieved_input_value=alphabet[y*polybius_square.length+(x-1)];if(retrieved_input_value===undefined){inp.value='';}else{inp.value=retrieved_input_value;}td.append(inp);return td;};const init=()=>{plaintext_textarea.value="";ciphertext_textarea.value="";key_input.value="";fill_select(version_select,AVAILABLE_VERSION);create_table(AVAILABLE_VERSION[0]);document.getElementsByTagName("footer")[0].innerHTML+=`<p>Copyright ${new Date().getFullYear()} ${AUTHOR_NAME}</p>`;};const main=()=>{init();};window.onload=main;